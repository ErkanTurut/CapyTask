generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model user {
  id             String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  image_uri      String?
  email          String           @unique
  first_name     String?
  last_name      String?
  createdAt      DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime         @default(now()) @updatedAt @db.Timestamptz(6)
  external_id    String?          @unique @db.Uuid
  steps          step[]
  user_team      user_team[]
  user_workspace user_workspace[]
  workspaces     workspace[]
}

model team {
  id           String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name         String
  description  String?
  image_uri    String?
  created_at   DateTime     @default(now()) @db.Timestamptz(6)
  updated_at   DateTime     @default(now()) @updatedAt @db.Timestamptz(6)
  workspace_id String       @db.Uuid
  identity     String
  plans        plan[]
  workspace    workspace    @relation(fields: [workspace_id], references: [id], onDelete: Cascade)
  users        user_team[]
  work_order   work_order[]

  @@unique([identity, workspace_id])
  @@unique([name, workspace_id])
  @@index([workspace_id])
}

model workspace {
  id             String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name           String
  description    String?
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  updated_at     DateTime         @default(now()) @updatedAt @db.Timestamptz(6)
  url_key        String           @unique
  created_by     String           @db.Uuid
  image_uri      String?
  team           team[]
  user_workspace user_workspace[]
  user           user             @relation(fields: [created_by], references: [id])

  @@index([url_key])
}

model user_team {
  user_id String  @db.Uuid
  team_id String  @db.Uuid
  role_id String? @db.Uuid
  role    role?   @relation(fields: [role_id], references: [id])
  team    team    @relation(fields: [team_id], references: [id])
  user    user    @relation(fields: [user_id], references: [id])

  @@id([user_id, team_id])
  @@index([team_id])
  @@index([role_id])
  @@index([user_id])
}

model user_workspace {
  user_id      String    @db.Uuid
  workspace_id String    @db.Uuid
  role_id      String?   @db.Uuid
  role         role?     @relation(fields: [role_id], references: [id])
  user         user      @relation(fields: [user_id], references: [id])
  workspace    workspace @relation(fields: [workspace_id], references: [id])

  @@id([user_id, workspace_id])
  @@index([user_id])
  @@index([workspace_id])
  @@index([role_id])
}

model role {
  id             String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name           Role
  description    String
  permissions    Permission[]     @default([])
  user_team      user_team[]
  user_workspace user_workspace[]
}

model plan {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String
  description String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @default(now()) @updatedAt @db.Timestamptz(6)
  team_id     String   @db.Uuid
  team        team     @relation(fields: [team_id], references: [id], onDelete: Cascade)
  step        step[]

  @@index([team_id])
}

model step {
  id             String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name           String
  description    String?
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  updated_at     DateTime @default(now()) @updatedAt @db.Timestamptz(6)
  parent_step_id String?  @db.Uuid
  created_by_id  String?  @db.Uuid
  order          Int?

  plan_id String @db.Uuid
  plan    plan   @relation(fields: [plan_id], references: [id], onDelete: Cascade)

  created_by  user?  @relation(fields: [created_by_id], references: [id])
  parent_step step?  @relation("step_sub_steps", fields: [parent_step_id], references: [id], onDelete: Cascade)
  sub_steps   step[] @relation("step_sub_steps")

  @@index([parent_step_id])
  @@index([created_by_id])
  @@index([plan_id])
}

model work_order {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String
  description String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @default(now()) @updatedAt @db.Timestamptz(6)
  work_plan   Json     @db.JsonB
  team_id     String   @db.Uuid
  team        team     @relation(fields: [team_id], references: [id], onDelete: Cascade)
  status      Status   @default(OPEN)

  @@index([team_id])
}

//useless part will be removed 

// model User {
//   id            String    @id @default(cuid())
//   name          String?
//   username      String?
//   gh_username   String?
//   email         String?   @unique
//   emailVerified DateTime?
//   image         String?
//   createdAt     DateTime  @default(now())
//   updatedAt     DateTime  @updatedAt
//   accounts      Account[]
//   posts         Post[]
//   sessions      Session[]
//   sites         Site[]
// }

// model Account {
//   id                       String  @id @default(cuid())
//   userId                   String
//   type                     String
//   provider                 String
//   providerAccountId        String
//   refresh_token            String?
//   refresh_token_expires_in Int?
//   access_token             String?
//   expires_at               Int?
//   token_type               String?
//   scope                    String?
//   id_token                 String?
//   session_state            String?
//   oauth_token_secret       String?
//   oauth_token              String?
//   user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

//   @@unique([provider, providerAccountId])
//   @@index([userId])
// }

// model Session {
//   id           String   @id @default(cuid())
//   sessionToken String   @unique
//   userId       String
//   expires      DateTime
//   user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

//   @@index([userId])
// }

// model VerificationToken {
//   identifier String
//   token      String   @unique
//   expires    DateTime

//   @@unique([identifier, token])
// }

// model Post {
//   id            String   @id @default(cuid())
//   title         String?
//   description   String?
//   content       String?
//   slug          String   @default(cuid())
//   image         String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/hxfcV5V-eInX3jbVUhjAt1suB7zB88uGd1j20b.png")
//   imageBlurhash String?  @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
//   createdAt     DateTime @default(now())
//   updatedAt     DateTime @updatedAt
//   published     Boolean  @default(false)
//   siteId        String?
//   userId        String?
//   site          Site?    @relation(fields: [siteId], references: [id], onDelete: Cascade)
//   user          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

//   @@unique([slug, siteId])
//   @@index([siteId])
//   @@index([userId])
// }

// model Site {
//   id            String   @id @default(cuid())
//   name          String?
//   description   String?
//   logo          String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/JRajRyC-PhBHEinQkupt02jqfKacBVHLWJq7Iy.png")
//   font          String   @default("font-cal")
//   image         String?  @default("https://public.blob.vercel-storage.com/eEZHAoPTOBSYGBE3/hxfcV5V-eInX3jbVUhjAt1suB7zB88uGd1j20b.png")
//   imageBlurhash String?  @default("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAhCAYAAACbffiEAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR4nN3XyZLDIAwE0Pz/v3q3r55JDlSBplsIEI49h76k4opexCK/juP4eXjOT149f2Tf9ySPgcjCc7kdpBTgDPKByKK2bTPFEdMO0RDrusJ0wLRBGCIuelmWJAjkgPGDSIQEMBDCfA2CEPM80+Qwl0JkNxBimiaYGOTUlXYI60YoehzHJDEm7kxjV3whOQTD3AaCuhGKHoYhyb+CBMwjIAFz647kTqyapdV4enGINuDJMSScPmijSwjCaHeLcT77C7EC0C1ugaCTi2HYfAZANgj6Z9A8xY5eiYghDMNQBJNCWhASot0jGsSCUiHWZcSGQjaWWCDaGMOWnsCcn2QhVkRuxqqNxMSdUSElCDbp1hbNOsa6Ugxh7xXauF4DyM1m5BLtCylBXgaxvPXVwEoOBjeIFVODtW74oj1yBQah3E8tyz3SkpolKS9Geo9YMD1QJR1Go4oJkgO1pgbNZq0AOUPChyjvh7vlXaQa+X1UXwKxgHokB2XPxbX+AnijwIU4ahazAAAAAElFTkSuQmCC")
//   subdomain     String?  @unique
//   customDomain  String?  @unique
//   message404    String?  @default("Blimey! You've found a page that doesn't exist.")
//   createdAt     DateTime @default(now())
//   updatedAt     DateTime @updatedAt
//   userId        String?
//   posts         Post[]
//   user          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

//   @@index([userId])
// }

// model Example {
//   id            Int     @id @default(autoincrement())
//   name          String?
//   description   String?
//   domainCount   Int?
//   url           String?
//   image         String?
//   imageBlurhash String?
// }

enum Status {
  OPEN
  IN_PROGRESS
  COMPLETED
  ON_HOLD
  CANCELED
}

enum Role {
  ADMIN
  MANAGER
  SUPERVISOR
  TECHNICIAN
  ENGINEER
  QUALITY_INSPECTOR
  OPERATOR
  OTHER
}

enum Permission {
  FULL_ACCESS
  CAN_EDIT
  CAN_COMMENT
  CAN_VIEW
  NO_ACCESS
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum PlanType {
  INSPECTION
  MAINTENANCE
  OTHER
}
