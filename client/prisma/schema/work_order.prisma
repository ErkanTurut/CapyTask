model work_order {
    id          String  @id @default(dbgenerated("nanoid(10)"))
    public_id   String  @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    name        String
    description String?

    sheduled_start DateTime?
    sheduled_end   DateTime?

    created_at DateTime @default(now()) @db.Timestamptz(6)
    updated_at DateTime @default(now()) @updatedAt @db.Timestamptz(6)

    status   Status        @default(OPEN)
    priority Priority      @default(LOW)
    type     WorkOrderType @default(INSPECTION)

    location_id String?
    location    location? @relation(fields: [location_id], references: [id])

    requested_by_id String? @db.Uuid
    requested_by    user?   @relation(fields: [requested_by_id], references: [id])

    source WorkOrderSource

    team_id String
    team    team   @relation(fields: [team_id], references: [id], onDelete: Cascade)

    work_plan_id String?
    work_plan    work_plan? @relation(fields: [work_plan_id], references: [id])

    company_id String
    company    company @relation(fields: [company_id], references: [id])

    work_order_asset work_order_asset[]
    work_step_status work_step_status[]

    @@index([team_id])
}

model work_step_status {
    id            String     @id @default(dbgenerated("nanoid(17)"))
    public_id     String     @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    status        Status     @default(OPEN)
    created_at    DateTime   @default(now()) @db.Timestamptz(6)
    updated_at    DateTime   @default(now()) @updatedAt @db.Timestamptz(6)
    work_order_id String
    work_step_id  String
    step_order    Int?
    work_order    work_order @relation(fields: [work_order_id], references: [id], onDelete: Cascade)
    work_step     work_step  @relation(fields: [work_step_id], references: [id])

    @@index([work_order_id])
}

model work_order_asset {
    work_order_id String
    asset_id      String
    asset         asset      @relation(fields: [asset_id], references: [id])
    work_order    work_order @relation(fields: [work_order_id], references: [id], onDelete: Cascade)

    @@id([work_order_id, asset_id])
    @@index([asset_id])
    @@index([work_order_id])
}
